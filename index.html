<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Agendamento do Caminh√£o Munck</title>
    <script src="https://cdn.tailwindcss.com"></script> </head>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <style>
        /* Ajuste para o calend√°rio n√£o ficar gigante */
        #calendario { max-height: 500px; margin-top: 20px; }
        .fc-event { cursor: pointer; }
        .fc-header-toolbar {
            margin-bottom: 0.5rem !important; /* Reduz o espa√ßo abaixo da barra */
            font-size: 0.85rem; /* Diminui a fonte de tudo na toolbar */
        }
        
        /* Diminui especificamente os bot√µes */
        .fc .fc-button {
            padding: 0.2rem 0.5rem !important; /* Bot√µes mais "magros" */
        }
        
        /* Diminui o t√≠tulo do m√™s */
        .fc .fc-toolbar-title {
            font-size: 1.1rem !important; /* T√≠tulo menor e mais discreto */
        }
    </style>
<body class="bg-gray-100 p-8">
    <div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-lg">
        <h1 class="text-2xl font-bold mb-4 text-center">üöó Agendamento do Caminh√£o Munck</h1>
        
        <div id="login-section">
            <input type="email" id="email" placeholder="E-mail" class="w-full mb-2 p-2 border rounded">
            <button onclick="fazerLogin()" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Entrar</button>
        </div>

        <div id="user-section" class="hidden mt-6">
            <h2 class="font-semibold mb-2 text-gray-700">Solicitar Carro</h2>
            <select id="car-select" class="w-full mb-2 p-2 border rounded">
                <option value="1">Carro A (Toyota Corolla)</option>
                <option value="2">Carro B (Hyundai HB20)</option>
            </select>
            <h2 class="font-semibold mb-2 text-gray-400">Data inicial</h2>
            <input type="datetime-local" id="reserva-inicial" class="w-full mb-2 p-2 border rounded">
            <h2 class="font-semibold mb-2 text-gray-400">Data final</h2>
            <input type="datetime-local" id="reserva-final" class="w-full mb-2 p-2 border rounded">
            <button onclick="solicitarAgendamento()" class="w-full bg-green-500 text-white p-2 rounded hover:bg-green-600">Solicitar Reserva</button>
        </div>
        
        <div id="calendar-container" class="mt-8 bg-white p-4 rounded-lg shadow hidden">
            <h2 class="text-lg font-bold mb-4 text-gray-700">üìÖ Agenda de Reservas</h2>
            <div id="calendario"></div>
        </div>        
        
        <div id="manager-section" class="hidden mt-6 border-t pt-4">
            <h2 class="font-bold text-red-600 mb-2">Painel do Gestor</h2>
            <div id="lista-pendente" class="text-sm text-gray-600">Carregando solicita√ß√µes...</div>
        </div>
    </div>

    <script>
      
        /**
         * Inicializa o calend√°rio com os dados vindos do n8n.
         * @param {Array} reservas - Lista de objetos [{title, start, end, color}]
         */
        function inicializarAgenda(reservas) {
            // Mostra o container do calend√°rio
            document.getElementById('calendar-container').classList.remove('hidden');
        
            const calendarEl = document.getElementById('calendario');
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'pt-br',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth'
                },
                events: reservas, // O n8n deve enviar os dados neste formato
                eventClick: function(info) {
                    alert('\nIn√≠cio: ' + info.event.start.toLocaleString() + '\nFim: ' + info.event.end.toLocaleString());
                }
            });
        
            calendar.render();
        }
        
        // Exemplo de como voc√™ chamaria isso ap√≥s o login:
        async function carregarDadosEAgenda() {
            // 1. Faz o fetch no seu n8n
            // const response = await fetch('SUA_URL_N8N_PARA_LISTAR_RESERVAS');
            // const dadosDoBanco = await response.json();
        
            // 2. Transforma os dados do MySQL para o formato que o calend√°rio entende
            const formatadoParaCalendario = [
                { start: '2026-02-10T10:00:00', end: '2026-02-10T14:00:00', color: '#3b82f6' },
                { start: '2026-02-12T08:00:00', end: '2026-02-12T15:00:00', color: '#f59e0b' }
            ];
        
            inicializarAgenda(formatadoParaCalendario);
        }


        const N8N_WEBHOOK_URL = 'https://conta421.app.n8n.cloud/webhook-test/d6bb9b78-47c4-4ad8-9c4f-1fe9c3ea7a14'; // Substitua pela sua URL

        let currentUser = null;

        async function fazerLogin() {
            const email = document.getElementById('email').value;
            // Aqui voc√™ enviaria para o Workflow A do n8n
            // Simulando resposta do n8n:
            currentUser = { email: email, role: email.includes('admin') ? 'manager' : 'user' };
            
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('user-section').classList.remove('hidden');

            if (currentUser.role === 'manager') {
                document.getElementById('manager-section').classList.remove('hidden');
                carregarSolicitacoes();
            }
            carregarDadosEAgenda();
        }

        async function solicitarAgendamento() {
            const inicio = document.getElementById('reserva-inicial').value;
            const fim = document.getElementById('reserva-final').value;

            const response = await fetch(N8N_WEBHOOK_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user: currentUser.email, data_inicio: inicio, data_fim: fim })
            });

            if (response.ok) alert('Solicita√ß√£o enviada!');
        }

        async function carregarSolicitacoes() {
            // Aqui o JavaScript chamaria o Workflow C do n8n para listar agendamentos pendentes
            document.getElementById('lista-pendente').innerHTML = "Nenhuma pend√™ncia no momento.";
        }
    </script>
</body>
</html>
