<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Agendamento do Caminh√£o Munck</title>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        #calendario { max-height: 500px; margin-top: 20px; }
        .fc-event { cursor: pointer; }
        .fc-header-toolbar {
            margin-bottom: 0.5rem !important;
            font-size: 0.85rem;
        }
        .fc .fc-button { padding: 0.2rem 0.5rem !important; }
        .fc .fc-toolbar-title { font-size: 1.1rem !important; }
    </style>
</head>

<body class="bg-gray-100 p-4 md:p-8">
    <h1 class="text-3xl font-bold mb-8 text-center text-gray-800">üöó Agendamento do Caminh√£o Munck</h1>

    <div class="max-w-7xl mx-auto flex flex-col lg:flex-row gap-6 items-start">
        
        <div class="w-full lg:w-1/4 space-y-6">
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <div id="login-section">
                    <h2 class="font-bold mb-4 text-gray-700">Acesso</h2>
                    <input type="email" id="email" placeholder="E-mail" class="w-full mb-2 p-2 border rounded text-sm">
                    <button onclick="fazerLogin()" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600 transition">Entrar</button>
                </div>

                <div id="user-section" class="hidden mt-4">
                    <h2 class="text-lg font-bold mb-4 text-blue-600 border-b pb-2">Nova Reserva</h2>
                    
                    <h2 class="font-semibold mb-1 text-gray-500 text-xs uppercase">Atividade</h2>
                    <textarea id="atividade" placeholder="Detalhamento da atividade..." rows="3" class="w-full mb-3 p-2 border rounded text-sm"></textarea>
                    
                    <h2 class="font-semibold mb-1 text-gray-500 text-xs uppercase">Data inicial</h2>
                    <input type="datetime-local" id="reserva-inicial" class="w-full mb-3 p-2 border rounded text-sm">
                    
                    <h2 class="font-semibold mb-1 text-gray-500 text-xs uppercase">Data final</h2>
                    <input type="datetime-local" id="reserva-final" class="w-full mb-4 p-2 border rounded text-sm">
                    
                    <button onclick="solicitarAgendamento()" class="w-full bg-green-500 text-white p-2 rounded font-bold hover:bg-green-600 transition">Solicitar Reserva</button>
                </div>
            </div>
        </div>

        <div class="w-full lg:w-2/4">
            <div id="calendar-container" class="bg-white p-6 rounded-lg shadow-lg hidden">
                <h2 class="text-xl font-bold mb-4 text-gray-700 flex items-center gap-2">
                    <span>üìÖ</span> Agenda de Reservas
                </h2>
                <div id="calendario"></div>
            </div>
        </div>

        <div class="w-full lg:w-1/4">
            <div id="manager-section" class="hidden bg-white p-6 rounded-lg shadow-lg border-t-4 border-red-500">
                <h2 class="font-bold text-red-600 mb-4 text-lg flex items-center gap-2">
                    <span>üõ°Ô∏è</span> Painel do Gestor
                </h2>
                <div id="lista-pendente" class="text-sm text-gray-600 space-y-2">
                    <p class="italic">Carregando solicita√ß√µes...</p>
                </div>
            </div>
        </div>

    </div>
</body>

    <script>
      
        /**
         * Inicializa o calend√°rio com os dados vindos do n8n.
         * @param {Array} reservas - Lista de objetos [{atividade, start, end, color}]
         */
        function inicializarAgenda(reservas) {
            // Mostra o container do calend√°rio
            document.getElementById('calendar-container').classList.remove('hidden');
        
            const calendarEl = document.getElementById('calendario');
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'pt-br',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth'
                },
                events: reservas, // O n8n deve enviar os dados neste formato
                eventClick: function(info) {
                    alert('\nIn√≠cio: ' + info.event.start.toLocaleString() + '\nFim: ' + info.event.end.toLocaleString());
                }
            });
        
            calendar.render();
        }
        
        // Exemplo de como voc√™ chamaria isso ap√≥s o login:
        async function carregarDadosEAgenda() {
            // 1. Faz o fetch no seu n8n
            // const response = await fetch('SUA_URL_N8N_PARA_LISTAR_RESERVAS');
            // const dadosDoBanco = await response.json();
        
            // 2. Transforma os dados do MySQL para o formato que o calend√°rio entende
            const formatadoParaCalendario = [
                { start: '2026-02-10T10:00:00', end: '2026-02-10T14:00:00', color: '#3b82f6' },
                { start: '2026-02-12T08:00:00', end: '2026-02-12T15:00:00', color: '#f59e0b' }
            ];
        
            inicializarAgenda(formatadoParaCalendario);
        }


        const N8N_WEBHOOK_URL = 'https://conta421.app.n8n.cloud/webhook-test/d6bb9b78-47c4-4ad8-9c4f-1fe9c3ea7a14'; // Substitua pela sua URL

        let currentUser = null;

        async function fazerLogin() {
            const email = document.getElementById('email').value;
            // Aqui voc√™ enviaria para o Workflow A do n8n
            // Simulando resposta do n8n:
            currentUser = { email: email, role: email.includes('admin') ? 'manager' : 'user' };
            
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('user-section').classList.remove('hidden');

            if (currentUser.role === 'manager') {
                document.getElementById('manager-section').classList.remove('hidden');
                carregarSolicitacoes();
            }
            carregarDadosEAgenda();
        }

        async function solicitarAgendamento() {
            const inicio = document.getElementById('reserva-inicial').value;
            const fim = document.getElementById('reserva-final').value;
            const atividade = document.getElementById('atividade').value;

            const response = await fetch(N8N_WEBHOOK_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user: currentUser.email, data_inicio: inicio, data_fim: fim, atividade: atividade })
            });

            if (response.ok) alert('Solicita√ß√£o enviada!');
        }

        async function carregarSolicitacoes() {
            // Aqui o JavaScript chamaria o Workflow C do n8n para listar agendamentos pendentes
            document.getElementById('lista-pendente').innerHTML = "Nenhuma pend√™ncia no momento.";
        }
    </script>
</body>
</html>
